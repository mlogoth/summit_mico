<?xml version="1.0"?>
<robot name="summit_xl" 
  xmlns:xacro="http://www.ros.org/wiki/xacro">


  <xacro:include filename="$(find summit_description)/urdf/bases/summit_xl_base.gazebo.xacro" />

  <xacro:macro name="summit_xl_hl_base" params="prefix publish_bf hq virtual_platform_joints:=false interface:='velocity' *origin">

    <!-- Robot mechanical and motor parameters -->
    <xacro:property name="PI" value="3.1415926535897931"/>
    <xacro:property name="wheel_width" value="0.175" />

    <!-- BASE FOOTPRINT -->
    <xacro:if value="${publish_bf}">
      <link name="${prefix}base_footprint">
        <visual>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <box size="0.001 0.001 0.001" />
          </geometry>
        </visual>
        <inertial>
          <mass value="15.0" />
          <origin xyz="0 0 0" />
          <inertia ixx="30.391" ixy="0.004" ixz="0.0" iyy="36.853" iyz="0.0" izz="36.125" />
        </inertial>
      </link>

      <joint name="${prefix}base_footprint_joint" type="fixed">
        <origin xyz="0 0 ${wheel_radius}" rpy="0 0 0" />
        <!-- ${wheel_radius} property must be defined inside wheel description -->
        <parent link="${prefix}base_footprint"/>
        <child link="${prefix}base_link" />
      </joint>
    </xacro:if>

    <!-- BASE_LINK -->
    <link name="${prefix}base_link">
      <inertial>
        <mass value="15.0" />
        <origin xyz="0 0 0" />
        <inertia ixx="23.391" ixy="0.004" ixz="0.0" iyy="23.853" iyz="0.0" izz="36.125" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <xacro:if value="${hq}">
          <geometry>
            <mesh filename="package://summit_description/meshes/bases/summit_xl_hl_chassis.dae"/>
          </geometry>
        </xacro:if>
        <xacro:unless value="${hq}">
          <geometry>
            <mesh filename="package://summit_description/meshes/bases/summit_xl_hl_chassis.dae"/>
          </geometry>
        </xacro:unless>
        <material name="darkgrey">
          <color rgba="0.1 0.1 0.1 1"/>
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0 " />
        <geometry>
          <mesh filename="package://summit_description/meshes/bases/summit_xl_hl_chassis.dae"/>
        </geometry>
      </collision>
    </link>


    <!-- Add Virtual Platform Joints in URDF -->
    <xacro:if value="${virtual_platform_joints}">

      <link name="${prefix}world">
        <inertial>
          <mass value="5.0" />
          <origin xyz="0 0 0" />
          <inertia ixx="5.0" ixy="0.00" ixz="0.0" iyy="5.0" iyz="0.0" izz="5.0" />
        </inertial>
      </link>
      <!-- robot world -> prismatic (x) -> linear_1 -->
      <link name="${prefix}platform_linear_1">
        <inertial>
          <mass value="5.0" />
          <origin xyz="0 0 0" />
          <inertia ixx="5.0" ixy="0.00" ixz="0.0" iyy="5.0" iyz="0.0" izz="5.0" />
        </inertial>
      </link>
      <!-- linear_1 -> prismatic (y) -> linear_2 -->
      <link name="${prefix}platform_linear_2">
        <inertial>
          <mass value="5.0" />
          <origin xyz="0 0 0" />
          <inertia ixx="5.0" ixy="0.00" ixz="0.0" iyy="5.0" iyz="0.0" izz="5.0" />
        </inertial>
      </link>

      <joint name="${prefix}platform_prismatic_x" type="prismatic">
        <xacro:insert_block name="origin" />
        <parent link="${prefix}world"/>
        <child link="${prefix}platform_linear_1" />
        <axis xyz="1 0 0"/>
        <limit lower="-500" upper="500" effort="1000" velocity="6"/>
        <joint_properties damping="1.5" friction="0.4"/>
      </joint>

      <joint name="${prefix}platform_prismatic_y" type="prismatic">
        <origin xyz="0 0 0" rpy="0 0 0" />
        <parent link="${prefix}platform_linear_1"/>
        <child link="${prefix}platform_linear_2" />
        <axis xyz="0 1 0"/>
        <limit lower="-500" upper="500" effort="1000" velocity="6"/>
        <joint_properties damping="1.5" friction="0.4"/>
      </joint>

      <joint name="${prefix}platform_continuous_z" type="continuous">
        <origin xyz="0 0 0" rpy="0 0 0" />
        <parent link="${prefix}platform_linear_2"/>
        <child link="${prefix}base_footprint" />
        <axis xyz="0 0 1"/>
        <limit lower="-500" upper="500" effort="1000" velocity="6"/>
        <joint_properties damping="1.5" friction="0.4"/>
      </joint>

      <xacro:if value="${interface == 'position'}">
        <xacro:property name="hwInterface" value="hardware_interface/PositionJointInterface"/>
      </xacro:if>

      <xacro:if value="${interface == 'effort'}">
        <xacro:property name="hwInterface" value="hardware_interface/EffortJointInterface"/>
      </xacro:if>

      <xacro:unless value="${interface in ['position','effort']}">
        <xacro:property name="hwInterface" value="hardware_interface/VelocityJointInterface"/>
      </xacro:unless>



      <transmission name="${prefix}platform_prismatic_x_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="${prefix}platform_prismatic_x">
          <hardwareInterface>${hwInterface}</hardwareInterface>
        </joint>
        <actuator name="${prefix}platform_prismatic_x_actuator">
          <hardwareInterface>${hwInterface}</hardwareInterface>
          <mechanicalReduction>1</mechanicalReduction>
        </actuator>
      </transmission>

      <transmission name="${prefix}platform_prismatic_y_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="${prefix}platform_prismatic_y">
          <hardwareInterface>${hwInterface}</hardwareInterface>
        </joint>
        <actuator name="${prefix}platform_prismatic_y_actuator">
          <hardwareInterface>${hwInterface}</hardwareInterface>
          <mechanicalReduction>1</mechanicalReduction>
        </actuator>
      </transmission>

      <transmission name="${prefix}platform_continuous_z_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="${prefix}platform_continuous_z">
          <hardwareInterface>${hwInterface}</hardwareInterface>
        </joint>
        <actuator name="${prefix}platform_continuous_z_actuator">
          <hardwareInterface>${hwInterface}</hardwareInterface>
          <mechanicalReduction>1</mechanicalReduction>
        </actuator>
      </transmission>

    </xacro:if>


  </xacro:macro>
</robot>
